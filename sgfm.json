{
  "AWSTemplateFormatVersion" : "2010-09-09",
  
  "Description" : "DevopsFactory Security Group Stack. Provisions: Follow Me Security Group",
  
  "Parameters" : {
    "VpcId" : {
      "Type" : "String",
      "AllowedPattern": "vpc-[a-f0-9]{8}",
      "ConstraintDescription": "Must be valid VPC identifier vpc-xxxxxxxx", 
      "Description": "The ID of the Devops Factory Virtual Private Network."
    },
    "FollowMeIpAddress": {
      "Type": "String",
      "Description": "Public IP address of your current router/network.", 
      "AllowedPattern": "\\d{1,3}+\\.\\d{1,3}+\\.\\d{1,3}+\\.\\d{1,3}", 
      "ConstraintDescription": "Must be a valid CIDR IP address xx.xx.xx.xx",       
      "MaxLength": "15", 
      "MinLength": "1" 
    }    
  },    
  "Resources": {  
    "SecurityGroupDevopsfactoryFollowme" : {
      "Type" : "AWS::EC2::SecurityGroup",
      "Properties" : {
        "GroupDescription" : "Provides Devops Factory Android App user access to control instances",
        "VpcId" : {"Ref" : "VpcId"},
        "Tags" : [
          { "Key" : "Name", "Value" : "SG-devopsfactory-followmeame" }                        
        ],                
        "SecurityGroupIngress" : [
          { "IpProtocol" : "tcp", "FromPort" : "22", "ToPort" : "22", "CidrIp" :  { "Fn::Join" : [ "", [ { "Ref" : "FollowMeIpAddress"}, "/32"] ]}  }           
        ]
      }
    }                          
   },   
   "Outputs" : {
    "FollowmeSgId" : {
      "Description" : "Defops Factory Follow Me Security Group ID",
      "Value" : {"Ref" : "SecurityGroupDevopsfactoryFollowme" }
    }
   }
   
}
